{% extends 'base.html.twig' %}

{% block body %}
<h1 class="text-center text-3xl md:text-4xl lg:text-5xl font-extrabold text-orange-600 mt-12 shadow-md">
    Checkout
    <br><br>
</h1>

<div class="container mx-auto mt-5">
    <div class="max-w-2xl mx-auto bg-white rounded-lg shadow-md p-6">

        {{ form_start(form) }}

{% if form.adresse.adresse_existante is defined %}
 <div class="mb-4">
            {{ form_label(form.adresse.adresse_existante, null, { 'attr': {'class': 'block text-gray-700 font-bold mb-2'} }) }}
            {{ form_widget(form.adresse.adresse_existante, { 'attr': {'class': 'form-input mt-1 block w-full border-gray-300 rounded-md shadow-sm border-orange-500 focus:ring focus:ring-orange-500 focus:ring-opacity-50'} }) }}
        </div>
        {% endif %}

 <div class="mb-4">
            {{ form_widget(form.adresse.id_adresse, { 'attr': {'class': 'form-input mt-1 block w-full border-gray-300 rounded-md shadow-sm border-orange-500 focus:ring focus:ring-orange-500 focus:ring-opacity-50'} }) }}
        </div>

        <div class="mb-4">
            {{ form_label(form.adresse.libelle_voie, null, { 'attr': {'class': 'block text-gray-700 font-bold mb-2'} }) }}
            {{ form_widget(form.adresse.libelle_voie, { 'attr': {'class': 'form-input mt-1 block w-full border-gray-300 rounded-md shadow-sm border-orange-500 focus:ring focus:ring-orange-500 focus:ring-opacity-50'} }) }}
        </div>

         <div class="mb-4">
            {{ form_label(form.adresse.type_adresse, null, { 'attr': {'class': 'block text-gray-700 font-bold mb-2'} }) }}
            {{ form_widget(form.adresse.type_adresse, { 'attr': {'class': 'form-input mt-1 block w-full border-gray-300 rounded-md shadow-sm border-orange-500 focus:ring focus:ring-orange-500 focus:ring-opacity-50'} }) }}
        </div>
        
        <div class="mb-4">
            {{ form_label(form.adresse.code_postal, null, { 'attr': {'class': 'block text-gray-700 font-bold mb-2'} }) }}
            {{ form_widget(form.adresse.code_postal, { 'attr': {'class': 'form-input mt-1 block w-full border-gray-300 rounded-md shadow-sm border-orange-500 focus:ring focus:ring-orange-500 focus:ring-opacity-50'} }) }}
           
        </div>

        <div class="mb-4">
            {{ form_label(form.adresse.ville, null, { 'attr': {'class': 'block text-gray-700 font-bold mb-2'} }) }}
            {{ form_widget(form.adresse.ville, { 'attr': {'class': 'form-input mt-1 block w-full border-gray-300 rounded-md shadow-sm border-orange-500 focus:ring focus:ring-orange-500 focus:ring-opacity-50'} }) }}
           
        </div>

        <div class="mb-4">
            {{ form_label(form.adresse.pays, null, { 'attr': {'class': 'block text-gray-700 font-bold mb-2'} }) }}
            {{ form_widget(form.adresse.pays, { 'attr': {'class': 'form-input mt-1 block w-full border-gray-300 rounded-md shadow-sm border-orange-500 focus:ring focus:ring-orange-500 focus:ring-opacity-50'} }) }}
          
        </div>

        <div>
         {{ form_label(form.client.nom_carte, null, { 'attr': {'class': 'block text-gray-700 font-bold mb-2'} }) }}
         {{ form_widget(form.client.nom_carte, { 'attr': {'class': 'form-input mt-1 block w-full border-gray-300 rounded-md shadow-sm border-orange-500 focus:ring focus:ring-orange-500 focus:ring-opacity-50'} }) }}
        </div>
         <div>
         {{ form_label(form.client.telephone, null, { 'attr': {'class': 'block text-gray-700 font-bold mb-2'} }) }}
         {{ form_widget(form.client.telephone, { 'attr': {'class': 'form-input mt-1 block w-full border-gray-300 rounded-md shadow-sm border-orange-500 focus:ring focus:ring-orange-500 focus:ring-opacity-50'} }) }}
        </div>
         <div>
        {{ form_label(form.client.methode_paiement, null, { 'attr': {'class': 'block text-gray-700 font-bold mb-2'} }) }}
         {{ form_widget(form.client.methode_paiement, { 'attr': {'class': 'form-input mt-1 block w-full border-gray-300 rounded-md shadow-sm border-orange-500 focus:ring focus:ring-orange-500 focus:ring-opacity-50'} }) }}
        </div>
        <div>
         {{ form_label(form.client.numero_carte, null, { 'attr': {'class': 'block text-gray-700 font-bold mb-2'} }) }}
         {{ form_widget(form.client.numero_carte, { 'attr': {'class': 'form-input mt-1 block w-full border-gray-300 rounded-md shadow-sm border-orange-500 focus:ring focus:ring-orange-500 focus:ring-opacity-50'} }) }}
        </div>
        <div>
         {{ form_label(form.client.date_expiration_carte, null, { 'attr': {'class': 'block text-gray-700 font-bold mb-2'} }) }}
         {{ form_widget(form.client.date_expiration_carte, { 'attr': {'class': 'form-input mt-1 block w-full border-gray-300 rounded-md shadow-sm border-orange-500 focus:ring focus:ring-orange-500 focus:ring-opacity-50'} }) }}
        </div>
        <div>
         {{ form_label(form.client.CVV, null, { 'attr': {'class': 'block text-gray-700 font-bold mb-2'} }) }}
         {{ form_widget(form.client.CVV, { 'attr': {'class': 'form-input mt-1 block w-full border-gray-300 rounded-md shadow-sm border-orange-500 focus:ring focus:ring-orange-500 focus:ring-opacity-50'} }) }}
        </div>
<br><br>
        <div class="col-span-2">
			<input type="submit" value="Continuer au paiement" class='w-full text-white bg-orange-400 text-white py-2 rounded-md hover:bg-orange-600 focus:ring-primary-600 focus:border-primary-600 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500'>
		</div>
        

        {{ form_end(form) }}
    </div>
</div>
{% endblock %}


{% block javascripts %}
<script>
document.addEventListener('DOMContentLoaded', function () {
    const adresseExistante = document.querySelector('[name="main_checkout[adresse][adresse_existante]"]');
    const newAddressFields = [
        document.querySelector('[name="main_checkout[adresse][libelle_voie]"]').closest('.mb-4'),
        document.querySelector('[name="main_checkout[adresse][code_postal]"]').closest('.mb-4'),
        document.querySelector('[name="main_checkout[adresse][ville]"]').closest('.mb-4'),
        document.querySelector('[name="main_checkout[adresse][pays]"]').closest('.mb-4'),
        document.querySelector('[name="main_checkout[adresse][type_adresse]"]').closest('.mb-4'),
    ];

    // Fonction qui montre ou cache les champs de la nouvelle adresse
    function toggleNewAddressFields() {
        if (adresseExistante.value === '') {
            newAddressFields.forEach(field => {
                field.style.display = 'block';
                field.disabled = false; // Réactiver les champs si aucune adresse existante n'est choisie
            });
        } else {
            newAddressFields.forEach(field => {
                field.style.display = 'none';
                field.disabled = true; // Désactiver les champs s'ils ne doivent pas être envoyés
                field.removeAttribute('required');
            });
        }
    }

    // Initialisation au chargement de la page
    toggleNewAddressFields();

    // Écouter les changements de la sélection d'adresse
    adresseExistante.addEventListener('change', toggleNewAddressFields);
});
</script>
{% endblock %}